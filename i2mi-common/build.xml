<!-- $Id: build.xml,v 1.2 2006-08-07 18:34:59 blair Exp $ -->

<project name="i2mi-common" default="dist" basedir=".">

  <!-- Global Properties -->
  <property name="app.name"       value="i2mi-common"/>
  <property name="impl.url"       value="http://middleware.internet2.edu/"/>
  <property name="impl.vendor"    value="Internet2"/>
  <property name="impl.version"   value="0.0.2-cvs"/>

  <property name="build"                  location="${basedir}/build"/>
  <property name="dist"                   location="${basedir}/dist"/>
  <property name="build.lib"              location="${build}/lib"/>

  <property name="lib"                    location="${basedir}/lib"/>
  <!-- Global Properties -->

  <!-- clean -->
  <target name="clean" 
          description="clean up" 
  >
    <delete dir="${build}"/>
    <delete dir="${dist}"/>
  </target>
  <!-- clean -->

  <!-- dist -->
  <target name="dist" 
          description="package i2mi-common"
          depends="init"
  >

    <!-- unpack the third party jars.  and, yes, this is in fact horribly atrocious. -->
    <unzip dest="${build.lib}">
      <fileset dir="${lib}">
        <include name="*.jar"/>
      </fileset>
    </unzip>
    <!-- include the README -->
    <copy file="${lib}/README.txt" 
          tofile="${build.lib}/README.txt"
    />
    <!-- include the LICENSE -->
    <copy file="${basedir}/LICENSE.txt" 
          tofile="${build.lib}/LICENSE.txt"
    />

    <jar destfile="${dist}/${app.name}-${DSTAMP}.jar" basedir="${build.lib}">
      <manifest>
        <attribute name="Built-By"                value="${user.name}"/>
        <attribute name="Implementation-Vendor"   value="${impl.vendor}" />
        <attribute name="Implementation-Title"    value="${app.name}" />
        <attribute name="Implementation-Version"  value="${impl.version}" />
        <attribute name="Implementation-URL"      value="${impl.url}" />
      </manifest>
    </jar>
    <copy file="${dist}/${app.name}-${DSTAMP}.jar"   
          tofile="${dist}/${app.name}.jar" 
    />
    <copy file="${dist}/${app.name}-${DSTAMP}.jar"   
          tofile="${dist}/${app.name}-${impl.version}.jar" 
    />
  </target>
  <!-- dist -->

  <!-- init -->
  <target name="init">
    <tstamp/>
    <mkdir dir="${dist}"/>
    <!-- only define our classpath once -->
    <path id="project.classpath">
      <pathelement path="${classpath}"/>
      <fileset dir="${lib}">
        <include name="**/*.jar"/>
      </fileset>
    </path>
  </target>
  <!-- init -->

</project>

