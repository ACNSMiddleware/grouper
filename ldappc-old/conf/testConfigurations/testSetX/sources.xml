<?xml version="1.0" encoding="utf-8"?>

<!--
Grouper's subject resolver configuration
$Id: sources.xml,v 1.1 2007-01-11 21:36:17 singer Exp $
-->

<sources>

    <!-- 
        **************************************************************
        **************** BEGIN GROUPER SOURCES ***********************
        **************************************************************
    -->
  <!-- Group Subject Resolver -->
  <!-- 
    NOTE: It is recommended that you **not** change the default
          values for this source adapter.
  -->
  <source adapterClass="edu.internet2.middleware.grouper.GrouperSourceAdapter">
    <id>g:gsa</id>
    <name>Grouper: Group Source Adapter</name>
    <type>group</type>
  </source>
  <!-- Group Subject Resolver -->

  <source adapterClass="edu.internet2.middleware.subject.provider.JDBCSourceAdapter">
    <id>jdbc</id>
    <name>JDBC Source Adapter</name>
    <type>person</type>
    <init-param>
      <param-name>maxActive</param-name>
      <param-value>4</param-value>
    </init-param>
    <init-param>
      <param-name>maxIdle</param-name>
      <param-value>2</param-value>
    </init-param>
    <init-param>
      <param-name>maxWait</param-name>
      <param-value>5</param-value>
    </init-param>

    <!-- HSQLDB -->
    <init-param>
      <param-name>dbDriver</param-name>
      <param-value>org.hsqldb.jdbcDriver</param-value>
    </init-param>
    <init-param>
      <param-name>dbUrl</param-name>
      <!-- Use for Grouper 1.0:
      <param-value>jdbc:hsqldb:C:/nj/grouper/api/grouper-api-1.0/dist/run/grouper</param-value>
       -->
       <param-value>jdbc:hsqldb:C:/nj/grouper1.1qs/grouper-qs/grouper/dist/run/grouper</param-value>
    </init-param>

    <init-param>
      <param-name>dbUser</param-name>
      <param-value>sa</param-value>
    </init-param>
    <init-param>
      <param-name>dbPwd</param-name>
      <param-value></param-value>
    </init-param>

     <init-param>
      <param-name>SubjectID_AttributeType</param-name>
      <param-value>subjectId</param-value>
    </init-param>
    <init-param>
      <param-name>Name_AttributeType</param-name>
      <param-value>name</param-value>
    </init-param>
    <init-param>
      <param-name>Description_AttributeType</param-name>
      <param-value>name</param-value>
    </init-param>
    
    <search>
      <searchType>searchSubject</searchType>
      <param>
        <param-name>sql</param-name>
        <param-value>
          select * from Subject where (subjectId='%TERM%')  
        </param-value>
      </param>
    </search>
    <search>
      <searchType>searchSubjectByIdentifier</searchType>
      <param>
        <param-name>sql</param-name>
        <param-value>
          select * from Subject where (name='%TERM%')  
        </param-value>
      </param>
    </search>
    <search>
      <searchType>search</searchType>
        <param>
          <param-name>sql</param-name>
          <param-value>
            select * from Subject where 
                  (subjectId  like '%%TERM%%')
              or  (name       like '%%TERM%%')
          </param-value>
      </param>
    </search>
    
  </source>

    <!-- 
        *************************************************************
        **************** BEGIN SIGNET SOURCES ***********************
        *************************************************************
    -->
    <source
        adapterClass="edu.internet2.middleware.subject.provider.JDBCSourceAdapter">
        <id>local</id>
        <name>Signet Subject Source</name>
        <type>person</type>
        <type>group</type>
        <init-param>
            <param-name>maxActive</param-name>
            <param-value>4</param-value>
        </init-param>
        <init-param>
            <param-name>maxIdle</param-name>
            <param-value>2</param-value>
        </init-param>
        <init-param>
            <param-name>maxWait</param-name>
            <param-value>5</param-value>
        </init-param>

        <!-- connection params for HSQL -->
        <init-param>
            <param-name>dbDriver</param-name>
            <param-value>org.hsqldb.jdbcDriver</param-value>
        </init-param>
        <init-param>
            <param-name>dbUrl</param-name>
            <param-value>
                jdbc:hsqldb:hsql://localhost:9001/xdb
            </param-value>
        </init-param>
        <init-param>
            <param-name>dbUser</param-name>
            <param-value>sa</param-value>
        </init-param>
        <init-param>
            <param-name>dbPwd</param-name>
            <param-value></param-value>
        </init-param>
        <init-param>
            <param-name>SubjectID_AttributeType</param-name>
            <param-value>id</param-value>
        </init-param>
        <init-param>
            <param-name>Name_AttributeType</param-name>
            <param-value>name</param-value>
        </init-param>
        <init-param>
            <param-name>Description_AttributeType</param-name>
            <param-value>description</param-value>
        </init-param>
        <search>
            <searchType>searchSubject</searchType>
            <param>
                <param-name>sql</param-name>
                <param-value>
                    select subject.subjectid as id, subject.name as
                    name, lfnamet.lfname as lfname, loginidt.loginid as
                    loginid, desct.description as description 
                    from subject 
                    left join 
                        (select subjectid, searchvalue as lfname
                        from subjectattribute 
                        where name='name') as lfnamet
                        on subject.subjectid=lfnamet.subjectid 
                    left join
                        (select subjectid, searchvalue as loginid 
                        from subjectattribute 
                        where name='loginid') as loginidt
                        on subject.subjectid=loginidt.subjectid 
                    left join
                        (select subjectid, searchvalue as description 
                        from subjectattribute 
                        where name='description') as desct
                        on subject.subjectid=desct.subjectid 
                    where subject.subjectid = '%TERM%'
                </param-value>
            </param>
        </search>
        <search>
            <searchType>searchSubjectByIdentifier</searchType>
            <param>
                <param-name>sql</param-name>
                <param-value>
                    select subject.subjectid as id, subject.name as
                    name, lfnamet.lfname as lfname, loginidt.loginid as
                    loginid, desct.description as description 
                    from subject 
                    left join 
                        (select subjectid, searchvalue as lfname
                        from subjectattribute 
                        where name='name') as lfnamet
                        on subject.subjectid=lfnamet.subjectid 
                    left join
                        (select subjectid, searchvalue as loginid 
                        from subjectattribute 
                        where name='loginid') as loginidt
                        on subject.subjectid=loginidt.subjectid 
                    left join
                        (select subjectid, searchvalue as description 
                        from subjectattribute 
                        where name='description') as desct
                        on subject.subjectid=desct.subjectid 
                    where loginidt.loginid = '%TERM%'
                </param-value>
            </param>
        </search>
    </source>

</sources>

