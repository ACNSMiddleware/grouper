<?xml version="1.0" encoding="utf-8"?>

<!--
    Grouper and Signet sources for testing
-->

<sources>

    <!-- 
        *************************************************************
        *************** BEGIN GROUPER SOURCES ***********************
        *************************************************************
    -->
    <!-- Group Subject Resolver -->
    <!-- 
        NOTE: It is recommended that you **not** change the default
        values for this source adapter.
    -->
    <source
        adapterClass="edu.internet2.middleware.grouper.GrouperSourceAdapter">
        <id>g:gsa</id>
        <name>Grouper: Group Source Adapter</name>
        <type>group</type>
    </source>
    <!-- Group Subject Resolver -->

    <source
        adapterClass="edu.internet2.middleware.subject.provider.JDBCSourceAdapter">
        <id>qsuob</id>
        <name>Grouper Subject Source</name>
        <type>person</type>
        <init-param>
            <param-name>maxActive</param-name>
            <param-value>4</param-value>
        </init-param>
        <init-param>
            <param-name>maxIdle</param-name>
            <param-value>4</param-value>
        </init-param>
        <init-param>
            <param-name>maxWait</param-name>
            <param-value>-1</param-value>
        </init-param>
        <init-param>
            <param-name>dbDriver</param-name>
            <param-value>org.hsqldb.jdbcDriver</param-value>
        </init-param>
        <init-param>
            <param-name>dbUrl</param-name>
            <param-value>
                jdbc:hsqldb:hsql://localhost:51515/grouperdb
            </param-value>
        </init-param>
        <init-param>
            <param-name>dbUser</param-name>
            <param-value>sa</param-value>
        </init-param>
        <init-param>
            <param-name>dbPwd</param-name>
            <param-value></param-value>
        </init-param>
        <init-param>
            <param-name>SubjectID_AttributeType</param-name>
            <param-value>id</param-value>
        </init-param>
        <init-param>
            <param-name>Name_AttributeType</param-name>
            <param-value>name</param-value>
        </init-param>
        <init-param>
            <param-name>Description_AttributeType</param-name>
            <param-value>description</param-value>
        </init-param>

        <search>
            <searchType>searchSubject</searchType>
	        <param>
	      	  <param-name>numParameters</param-name>
	       	  <param-value>1</param-value>
	        </param>
            <param>
                <param-name>sql</param-name>
                <param-value>
                    select subject.subjectid as id, subject.name as
                    name, lfnamet.lfname as lfname, loginidt.loginid as
                    loginid, desct.description as description from
                    subject left join (select subjectid, value as lfname
                    from subjectattribute where name='name') as lfnamet
                    on subject.subjectid=lfnamet.subjectid left join
                    (select subjectid, value as loginid from
                    subjectattribute where name='loginid') as loginidt
                    on subject.subjectid=loginidt.subjectid left join
                    (select subjectid, value as description from
                    subjectattribute where name='description') as desct
                    on subject.subjectid=desct.subjectid where
                    subject.subjectid = ?
                </param-value>
            </param>
        </search>
        <search>
            <searchType>searchSubjectByIdentifier</searchType>
	        <param>
	      	  <param-name>numParameters</param-name>
	       	  <param-value>1</param-value>
	        </param>
            <param>
                <param-name>sql</param-name>
                <param-value>
                    select subject.subjectid as id, subject.name as
                    name, lfnamet.lfname as lfname, loginidt.loginid as
                    loginid, desct.description as description from
                    subject left join (select subjectid, value as lfname
                    from subjectattribute where name='name') as lfnamet
                    on subject.subjectid=lfnamet.subjectid left join
                    (select subjectid, value as loginid from
                    subjectattribute where name='loginid') as loginidt
                    on subject.subjectid=loginidt.subjectid left join
                    (select subjectid, value as description from
                    subjectattribute where name='description') as desct
                    on subject.subjectid=desct.subjectid where
                    loginidt.loginid = ?
                </param-value>
            </param>
        </search>
        <search>
            <searchType>search</searchType>
	        <param>
	      	  <param-name>numParameters</param-name>
	       	  <param-value>4</param-value>
	        </param>
            <param>
                <param-name>sql</param-name>
                <param-value>
                    select subject.subjectid as id, subject.name as
                    name, lfnamet.lfname as lfname, loginidt.loginid as
                    loginid, desct.description as description from
                    subject left join (select subjectid, value as lfname
                    from subjectattribute where name='name') as lfnamet
                    on subject.subjectid=lfnamet.subjectid left join
                    (select subjectid, value as loginid from
                    subjectattribute where name='loginid') as loginidt
                    on subject.subjectid=loginidt.subjectid left join
                    (select subjectid, value as description from
                    subjectattribute where name='description') as desct
                    on subject.subjectid=desct.subjectid where
                    (lower(name) like '%'||?||'%') or
                    (lower(lfnamet.lfname) like '%'||?||'%') or
                    (lower(loginidt.loginid) like '%'||?||'%') or
                    (lower(desct.description) like '%'||?||'%')
                </param-value>
            </param>
        </search>
    </source>

    <!-- 
        *************************************************************
        **************** BEGIN SIGNET SOURCES ***********************
        *************************************************************
    -->

  <source adapterClass="edu.internet2.middleware.signet.subjsrc.SignetJDBCSourceAdapter">
    <id>local_person</id>
    <name>Local Subject Source for People</name>
    <type>person</type>
    <init-param>
      <param-name>maxActive</param-name>
      <param-value>4</param-value>
    </init-param>
    <init-param>
      <param-name>maxIdle</param-name>
      <param-value>2</param-value>
    </init-param>
    <init-param>
      <param-name>maxWait</param-name>
      <param-value>5</param-value>
    </init-param>

    <!--  Database connection properties  -->
    <init-param>
      <param-name>dbDriver</param-name>
      <param-value>org.hsqldb.jdbcDriver</param-value>
    </init-param>
    <init-param>
      <param-name>dbUrl</param-name>
      <param-value>jdbc:hsqldb:hsql://localhost:51515/signetdb</param-value>
    </init-param>
    <init-param>
      <param-name>dbUser</param-name>
      <param-value>sa</param-value>
    </init-param>
    <init-param>
      <param-name>dbPwd</param-name>
      <param-value></param-value>
    </init-param>

     <init-param>
      <param-name>SubjectID_AttributeType</param-name>
      <param-value>subjectID</param-value>
    </init-param>
    <init-param>
      <param-name>Name_AttributeType</param-name>
      <param-value>name</param-value>
    </init-param>
    <init-param>
      <param-name>Description_AttributeType</param-name>
      <param-value>description</param-value>
    </init-param>

    <search>
        <searchType>searchSubject</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>1</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      '*' AS description,
                      '*' AS loginid
               FROM   Subject sub
               WHERE  sub.subjectTypeID = 'person'
               AND    sub.subjectID = ?
            </param-value>
       </param>
    </search>

    <search>
        <searchType>searchSubjectByIdentifier</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>1</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      '*' AS description,
                      log.value AS loginid
               FROM   Subject sub,
                      SubjectAttribute log
               WHERE  sub.subjectTypeID = 'person'
               AND    sub.subjectID = log.subjectID
               AND    log.name = 'loginid'
               AND    log.value = ?
            </param-value>
        </param>
    </search>
    <search>
       <searchType>search</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>3</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT DISTINCT 
                      sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      '*' AS description,
                      '*' AS loginid
               FROM   Subject sub,
                      SubjectAttribute att
               WHERE  sub.subjectTypeID = 'person'
               AND    sub.subjectID = att.subjectID
               AND   ((att.name = 'loginid' AND
                          lower(att.value) like lower(?||'%')) OR
                      (att.name = 'name' AND
                          lower(att.value) like lower(?||'%')) OR
                      (att.name = 'all' AND
                          lower(att.value) = lower(?)))
            </param-value>
        </param>
    </search>

  </source>

  <source adapterClass="edu.internet2.middleware.signet.subjsrc.SignetJDBCSourceAdapter">
    <id>local_group</id>
    <name>Local Subject Source for Groups</name>
    <type>group</type>
    <init-param>
      <param-name>maxActive</param-name>
      <param-value>4</param-value>
    </init-param>
    <init-param>
      <param-name>maxIdle</param-name>
      <param-value>2</param-value>
    </init-param>
    <init-param>
      <param-name>maxWait</param-name>
      <param-value>5</param-value>
    </init-param>

    <!--  Database connection properties  -->
    <init-param>
      <param-name>dbDriver</param-name>
      <param-value>org.hsqldb.jdbcDriver</param-value>
    </init-param>
    <init-param>
      <param-name>dbUrl</param-name>
      <param-value>jdbc:hsqldb:hsql://localhost:51515/signetdb</param-value>
    </init-param>
    <init-param>
      <param-name>dbUser</param-name>
      <param-value>sa</param-value>
    </init-param>
    <init-param>
      <param-name>dbPwd</param-name>
      <param-value></param-value>
    </init-param>

     <init-param>
      <param-name>SubjectID_AttributeType</param-name>
      <param-value>subjectID</param-value>
    </init-param>
    <init-param>
      <param-name>Name_AttributeType</param-name>
      <param-value>name</param-value>
    </init-param>
    <init-param>
      <param-name>Description_AttributeType</param-name>
      <param-value>name</param-value>
    </init-param>

    <search>
        <searchType>searchSubject</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>1</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      des.value  AS description
               FROM   Subject sub,
                      SubjectAttribute des
               WHERE  sub.subjectTypeID = 'group'
               AND    sub.subjectID = ?
               AND    sub.subjectID = des.subjectID
               AND    des.name = 'description'
            </param-value>
       </param>
    </search>
    <search>
        <searchType>searchSubjectByIdentifier</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>1</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      des.value  AS description
               FROM   Subject sub,
                      SubjectAttribute des
               WHERE  sub.subjectTypeID = 'group'
               AND    sub.subjectID = des.subjectID
               AND    des.name = 'description'
               AND    sub.subjectID = ?
            </param-value>
        </param>
    </search>
    <search>
       <searchType>search</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>3</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT DISTINCT 
                      sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      des.value AS description
               FROM   Subject sub,
                      SubjectAttribute att,
                      SubjectAttribute des
               WHERE  sub.subjectTypeID = 'group'
               AND    sub.subjectID = des.subjectID
               AND    des.name = 'description'
               AND    sub.subjectID = att.subjectID
               AND   ((att.name = 'name' AND
                          lower(att.value) like lower(?||'%')) OR
                      (att.name = 'all' AND
                          lower(att.value) = lower(?)) OR
                      (lower(sub.subjectID) like lower(?||'%'))
                     )
            </param-value>
        </param>
    </search>

  </source>
</sources>

