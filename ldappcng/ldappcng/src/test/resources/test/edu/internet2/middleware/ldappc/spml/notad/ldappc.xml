<?xml version="1.0" encoding="utf-8"?>

<ldappc xmlns="http://grouper.internet2.edu/ldappc"
        xmlns:ldappc="http://grouper.internet2.edu/ldappc"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://grouper.internet2.edu/ldappc classpath:/schema/ldappc.xsd">

  <!-- The targets element allows more than one target to be provisioned using the same configuration. -->
  <targets id="LDAP">

    <!-- Each target requires a unique identifier and a provider identifier. Multiple target elements are allowed. -->
    <target id="ldap" provider="ldap-provider" />

    <!-- Provision a grouper stem as an ldap organizationalUnit. -->
    <!-- If authoritative="true", orphan objects under the baseId matching the identifyingAttribute will be deleted. -->
    <object id="stem" authoritative="true">

      <!-- The OU DN. -->
      <identifier ref="stemDn" baseId="ou=testgroups,${base}">

        <!-- Identifies stem objects which exist on the target by objectclass attribute value. -->
        <identifyingAttribute name="objectclass" value="organizationalUnit" />

        <!-- The "old" OU DN calculated from stem update change log events. -->
        <alternateIdentifier ref="stemDnAlternateChangeLog" />
        
      </identifier>

      <!-- The OU "objectClass" attribute. -->
      <attribute name="objectClass" ref="stemObjectclass" />

      <!-- The OU "ou" attribute. -->
      <attribute name="ou" ref="stemOu" />

      <!-- TODO tests fail because of ordering <attribute name="description" ref="stemDescription" /> -->
    </object>

    <!-- Provision a grouper group as an ldap group. -->
    <!-- If authoritative="true", orphan objects under the baseId matching the identifyingAttribute will be deleted. -->
    <object id="group" authoritative="true">

      <!-- The group DN. -->
      <identifier ref="groupDn" baseId="ou=testgroups,${base}">

        <!-- Identifies group objects which exist on the target by objectClass attribute value. -->
        <identifyingAttribute name="objectClass" value="${groupObjectClass}" />

        <!-- The "old" group DN if a group has been renamed. -->
        <alternateIdentifier ref="groupDnAlternate" />

        <!-- The "old" group DN calculated from group update change log events. -->
        <alternateIdentifier ref="groupDnAlternateChangeLog" />
        
      </identifier>

      <!-- The group "objectClass" attribute. -->
      <attribute name="objectClass" ref="groupObjectclassEduMember" />

      <!-- The group "cn" attribute. -->
      <attribute name="cn" />

      <!-- The group "description" attribute. -->
      <attribute name="description" />

      <!-- The group "hasMember" attribute includes the names of the groups that are members of the group. -->
      <!-- The group "hasMember" attribute includes the ids of the subjects that are members of the group. -->
      <attribute name="hasMember" ref="hasMember" />

      <!-- The group "isMemberOf" attribute consists of the names of the groups that the group is a member of. -->
      <attribute name="isMemberOf" ref="groupIsMemberOf" />

      <!-- The group "member" attribute. -->
      <references name="member" emptyValue="" >
      
        <!-- Each <resolver:AttributeDefinition/> value referred to is resolved to an <ldappc:identifier/>. -->      
        <reference ref="membersLdap" toObject="member" />      
        <reference ref="membersGsa" toObject="group" />
        
      </references>
      
    </object>

    <!-- Do not provision grouper members, but enable lookup. -->
    <object id="member">

      <!-- The member DN. -->
      <identifier ref="memberDn" baseId="ou=testpeople,${base}">
        
        <!-- Identifies member objects which exist on the target by objectclass attribute value. -->
        <identifyingAttribute name="objectclass" value="person" />
        
      </identifier>

      <!-- The member "objectClass" attribute. No existing values will be deleted since retainAll is true. -->
      <attribute name="objectClass" ref="memberObjectclass" retainAll="true" />

      <!-- The member "isMemberOf" attribute consisting of the names of the groups that this member is a member of. -->
      <attribute name="isMemberOf" ref="memberIsMemberOf" />
      
    </object>

    <!-- Provision a group membership triggered by the grouper change log. -->
    <object id="groupMembership">

      <!-- The group DN calculated from membership change log events. -->
      <identifier ref="changeLogMembershipGroupDn" baseId="ou=testgroups,${base}" />

      <!-- The group "member" attribute. -->
      <references name="member" emptyValue="" >
      
        <!-- Each <resolver:AttributeDefinition/> value is resolved to an <ldappc:identifier/>. -->
        <reference ref="changeLogMembershipSubjectId" toObject="member" />
        
      </references>
      
    </object>

  </targets>

</ldappc>
 


