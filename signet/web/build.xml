<?xml version="1.0"?>
<project
	name="Signet Web Application"
	default="build" basedir=".">
	
	<property name="dist_webapp.dir"  value="${toplevel.dir}/webapp" />

	<property name="webapp.name"    value="signet" />
	
	<!-- =================== BUILD: Create Directories ===================== --> 
	<target name="prepare">
		<mkdir dir="${dist_webapp.dir}" /> 
		<mkdir dir="${dist_webapp.dir}/${webapp.name}" /> 
		<mkdir dir="${dist_webapp.dir}/${webapp.name}/WEB-INF" /> 
		<mkdir dir="${dist_webapp.dir}/${webapp.name}/WEB-INF/classes" /> 
		<mkdir dir="${dist_webapp.dir}/${webapp.name}/WEB-INF/lib" /> 
	</target>

	<!-- ================ BUILD: Copy JSPs and Static Files ================ --> 
	<target name="copy-static" depends="prepare">
		<copy todir="${dist_webapp.dir}/${webapp.name}">
			<fileset dir=".">
				<include name="**/*" />
				<exclude name="config" />
				<exclude name="config/*" />
				<exclude name="build.xml" />
				<exclude name="dist" />
				<exclude name="dist/**/*" />
			</fileset>
		</copy>
	</target>

	<!-- ================ BUILD: Copy config files ========================= --> 
	<target name="copy-config" depends="prepare">
		<!-- Webapp deployment descriptor file -->
		<copy file="config/web.xml"
			todir="${dist_webapp.dir}/${webapp.name}/WEB-INF" />
		<!-- Struts config and tag library descriptors -->
		<copy todir="${dist_webapp.dir}/${webapp.name}/WEB-INF">
			<fileset dir="config">
			<include name="web.xml" />
			<include name="struts-*.xml" />
			<include name="struts-*.tld" />
			<include name="tiles-defs.xml" />
			</fileset>
		</copy>
		
	</target>

	<!-- ================== BUILD: Clean Directory ========================= --> 
	<target name="clean">
		<delete dir="${dist_webapp.dir}" />
	</target>

	<!-- ================= BUILD: Build Webapp ========================== -->
	<target
		name="build"
		depends="clean, prepare, copy-static, copy-config"
		description="Build Signet web app">
		
		<!-- Copy our property files and O/R mappings for use at runtime -->
		<copy todir="${dist_webapp.dir}/${webapp.name}/WEB-INF/classes">
			<fileset dir="${source_config.dir}">
				<include name="**/*.cfg.xml"/>
				<include name="**/*.properties"/>
			</fileset>
			<fileset dir="${source_java.dir}">
				<include name="**/*.properties"/>
			</fileset>
		</copy>
		
		<copy todir="${dist_webapp.dir}/${webapp.name}/WEB-INF/lib">
			<fileset dir="${source_lib.dir}">
				<include name="**/*" /> 
				<exclude name="**/servlet-api.jar" />
				<exclude name="**/jconn2.jar" />
			</fileset>
			<fileset dir="${work_lib.dir}">
				<include name="${signet_jarfile}" />
				<include name="${signet_ui_jarfile}" />
			</fileset>
		</copy>

	</target>

</project>
