<?xml version="1.0" encoding="utf-8"?>

<!-- $Header: /home/hagleyj/i2mi/signet/config/sources.xml,v 1.19 2007-07-24 22:41:11 ddonn Exp $ -->

<!--
	Note that values that enclosed in "@" will be replaced during an
	Ant build with values that are specified in buildSignet.properties
-->

<sources>

  <source adapterClass="edu.internet2.middleware.signet.subjsrc.SignetJDBCSourceAdapter">
    <id>local_person</id>
    <name>Local Subject Source for People</name>
    <type>person</type>
    <init-param>
      <param-name>maxActive</param-name>
      <param-value>4</param-value>
    </init-param>
    <init-param>
      <param-name>maxIdle</param-name>
      <param-value>2</param-value>
    </init-param>
    <init-param>
      <param-name>maxWait</param-name>
      <param-value>5</param-value>
    </init-param>

    <!--  Database connection properties  -->
    <init-param>
      <param-name>dbDriver</param-name>
      <param-value>@DB_DRIVER@</param-value>
    </init-param>
    <init-param>
      <param-name>dbUrl</param-name>
      <param-value>@DB_URL@</param-value>
    </init-param>
    <init-param>
      <param-name>dbUser</param-name>
      <param-value>@DB_USERNAME@</param-value>
    </init-param>
    <init-param>
      <param-name>dbPwd</param-name>
      <param-value>@DB_PASSWORD@</param-value>
    </init-param>

     <init-param>
      <param-name>SubjectID_AttributeType</param-name>
      <param-value>subjectID</param-value>
    </init-param>
    <init-param>
      <param-name>Name_AttributeType</param-name>
      <param-value>name</param-value>
    </init-param>
    <init-param>
      <param-name>Description_AttributeType</param-name>
      <param-value>description</param-value>
    </init-param>

    <search>
        <searchType>searchSubject</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>1</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      '*' AS description,
                      '*' AS loginid
               FROM   Subject sub
               WHERE  sub.subjectTypeID = 'person'
               AND    sub.subjectID = ?
            </param-value>
       </param>
    </search>

    <search>
        <searchType>searchSubjectByIdentifier</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>1</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      '*' AS description,
                      log.value AS loginid
               FROM   Subject sub,
                      SubjectAttribute log
               WHERE  sub.subjectTypeID = 'person'
               AND    sub.subjectID = log.subjectID
               AND    log.name = 'loginid'
               AND    log.value = ?
            </param-value>
        </param>
    </search>
    <search>
       <searchType>search</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>3</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT DISTINCT 
                      sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      '*' AS description,
                      '*' AS loginid
               FROM   Subject sub,
                      SubjectAttribute att
               WHERE  sub.subjectTypeID = 'person'
               AND    sub.subjectID = att.subjectID
               AND   ((att.name = 'loginid' AND
                          lower(att.value) like lower(?||'%')) OR
                      (att.name = 'name' AND
                          lower(att.value) like lower(?||'%')) OR
                      (att.name = 'all' AND
                          lower(att.value) = lower(?)))
            </param-value>
        </param>
    </search>

  </source>

  <source adapterClass="edu.internet2.middleware.signet.subjsrc.SignetJDBCSourceAdapter">
    <id>local_group</id>
    <name>Local Subject Source for Groups</name>
    <type>group</type>
    <init-param>
      <param-name>maxActive</param-name>
      <param-value>4</param-value>
    </init-param>
    <init-param>
      <param-name>maxIdle</param-name>
      <param-value>2</param-value>
    </init-param>
    <init-param>
      <param-name>maxWait</param-name>
      <param-value>5</param-value>
    </init-param>

    <!--  Database connection properties  -->
    <init-param>
      <param-name>dbDriver</param-name>
      <param-value>@DB_DRIVER@</param-value>
    </init-param>
    <init-param>
      <param-name>dbUrl</param-name>
      <param-value>@DB_URL@</param-value>
    </init-param>
    <init-param>
      <param-name>dbUser</param-name>
      <param-value>@DB_USERNAME@</param-value>
    </init-param>
    <init-param>
      <param-name>dbPwd</param-name>
      <param-value>@DB_PASSWORD@</param-value>
    </init-param>

     <init-param>
      <param-name>SubjectID_AttributeType</param-name>
      <param-value>subjectID</param-value>
    </init-param>
    <init-param>
      <param-name>Name_AttributeType</param-name>
      <param-value>name</param-value>
    </init-param>
    <init-param>
      <param-name>Description_AttributeType</param-name>
      <param-value>name</param-value>
    </init-param>

    <search>
        <searchType>searchSubject</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>1</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      des.value  AS description
               FROM   Subject sub,
                      SubjectAttribute des
               WHERE  sub.subjectTypeID = 'group'
               AND    sub.subjectID = ?
               AND    sub.subjectID = des.subjectID
               AND    des.name = 'description'
            </param-value>
       </param>
    </search>
    <search>
        <searchType>searchSubjectByIdentifier</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>1</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      des.value  AS description
               FROM   Subject sub,
                      SubjectAttribute des
               WHERE  sub.subjectTypeID = 'group'
               AND    sub.subjectID = des.subjectID
               AND    des.name = 'description'
               AND    sub.subjectID = ?
            </param-value>
        </param>
    </search>
    <search>
       <searchType>search</searchType>
        <param>
        	<param-name>numParameters</param-name>
        	<param-value>3</param-value>
        </param>
        <param>
            <param-name>sql</param-name>
            <param-value>
               SELECT DISTINCT 
                      sub.subjectTypeID,
                      sub.subjectID,
                      sub.name,
                      des.value AS description
               FROM   Subject sub,
                      SubjectAttribute att,
                      SubjectAttribute des
               WHERE  sub.subjectTypeID = 'group'
               AND    sub.subjectID = des.subjectID
               AND    des.name = 'description'
               AND    sub.subjectID = att.subjectID
               AND   ((att.name = 'name' AND
                          lower(att.value) like lower(?||'%')) OR
                      (att.name = 'all' AND
                          lower(att.value) = lower(?)) OR
                      (lower(sub.subjectID) like lower(?||'%'))
                     )
            </param-value>
        </param>
    </search>

  </source>

</sources>
