<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 2.0//EN"
          "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping
		default-lazy="false" >

	<class
		name="edu.internet2.middleware.signet.AssignmentHistoryImpl"
		table="signet_assignment_history" >
		
		<id name="historyId" type="int" column="historyID">
			<generator class="native">
				<param name="sequence">assignmentHistorySerial</param>
			</generator>
		</id>

		<many-to-one
			name="assignment"
			class="edu.internet2.middleware.signet.AssignmentImpl"
			column="assignmentID"
			not-null="true"/>
			
		<property
			name="instanceNumber" />
			
		<many-to-one
			name="grantor"
			class="edu.internet2.middleware.signet.subjsrc.SignetSubject"
			column="grantorKey"
			not-null="true"/>

		<many-to-one
			name="grantee"
			class="edu.internet2.middleware.signet.subjsrc.SignetSubject"
			column="granteeKey"
			not-null="true"/>

		<many-to-one
			name="revoker"
			class="edu.internet2.middleware.signet.subjsrc.SignetSubject"
			column="revokerKey"
			not-null="false"/>

		<many-to-one
			name="proxySubject"
			class="edu.internet2.middleware.signet.subjsrc.SignetSubject"
			column="proxyKey"
			not-null="false"/>
		
		<many-to-one
			name="function"
			class="edu.internet2.middleware.signet.FunctionImpl"
			column="functionKey"
			cascade="none"
			not-null="true"/>

		<many-to-one
			name="scope"
			class="edu.internet2.middleware.signet.TreeNodeImpl"
			cascade="none"
			not-null="true">
			
			<column name="scopeID"/>
			<column name="scopeNodeID"/>
		</many-to-one>
		
		<!-- Limit values are mapped as a collection of value types. This mapping
			 is modeled after an example on page 212 of "Hibernate in Action".
		-->
		
		<set
		 name="limitValues"
		 table="signet_assignmentLimit_history"
		 cascade="all">
		 
			<key column="assignment_historyID"/>
			
			<composite-element
			 class="edu.internet2.middleware.signet.LimitValue">
				
				<many-to-one
				 name="limit"
				 cascade="none"
				 class="edu.internet2.middleware.signet.LimitImpl"
				 column="limitKey"/>

				<property
				 name="value"
				 type="string">
					<column name="value"/>
				</property>

			</composite-element>
		</set>
		
		<property
			name="status"
			type="edu.internet2.middleware.signet.StatusType"
			not-null="true"/>
		<property
			name="canGrant"
			type="boolean"
			not-null="true"/>
		<property
			name="canUse"
			type="boolean"
			not-null="true"/>
		<property
			name="effectiveDate"
			not-null="true"/>
		<property
			name="expirationDate"
			not-null="false"/>
		<property
			name="historyDatetime"
			not-null="true"/>
        <property
			name="modifyDatetime"
			column="modifyDatetime" />

	</class>
</hibernate-mapping>
