<html>
<head>
<title>JDBCSourceAdapter Documentation</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF">
<h3>JDBCSourceAdapter User Documentation</h3>
<p>The JDBCSourceAdapter is a reference implementation of the edu.internet2.middleware.subject.Source 
  interface in the Subject API. This implementation is designed to retrieve and 
  search for subjects in any JDBC data source which contains the <a href="#schema">schema</a> 
  below.</p>
<p><b><a name="schema"></a>Database Schema</b></p>
<p>In order to use the JDBCSourceAdapter, you'll need to create two tables in 
  your database: Subject and SubjectAttribute. The Subject table contains the 
  three required attributes associated with a subject: ID, type, and name. The 
  SubjectAttribute table stores other optional attributes as rows of name/value 
  pairs. In addition, this table can be used to store search values for the <i><a href="#searching">search()</a></i> 
  method.</p>
<table width="75%" border="1" cellpadding="4" cellspacing="0">
  <tr valign="top"> 
    <td colspan="4"><b>Subject Table</b></td>
  </tr>
  <tr bgcolor="#CCCCCC" valign="top"> 
    <td width="13%"><i><strong>Field</strong></i></td>
    <td width="10%"><i><b>Type</b></i></td>
    <td width="12%"><i><b>Required</b></i></td>
    <td width="65%"><i><strong>Desription</strong></i></td>
  </tr>
  <tr valign="top"> 
    <td width="13%">subjectID</td>
    <td width="10%">varchar</td>
    <td width="12%">Y</td>
    <td width="65%">A subject's unique ID.</td>
  </tr>
  <tr valign="top"> 
    <td width="13%">subjectTypeID</td>
    <td width="10%">varchar</td>
    <td width="12%">Y</td>
    <td width="65%">Indicates the type of subject. This version supports person, 
      group, and application types.</td>
  </tr>
  <tr valign="top"> 
    <td width="13%">name</td>
    <td width="10%">varchar</td>
    <td width="12%">Y</td>
    <td width="65%">Subject's name.</td>
  </tr>
</table>
<p>&nbsp;</p>
<table width="75%" border="1" cellpadding="4" cellspacing="0">
  <tr valign="top"> 
    <td colspan="4"><b>SubjectAttribute Table</b></td>
  </tr>
  <tr bgcolor="#CCCCCC" valign="top"> 
    <td width="13%"><i><strong>Field</strong></i></td>
    <td width="10%"><i><b>Type</b></i></td>
    <td width="12%"><i><b>Required</b></i></td>
    <td width="65%"><i><strong>Desription</strong></i></td>
  </tr>
  <tr valign="top"> 
    <td width="13%">subjectID</td>
    <td width="10%">varchar</td>
    <td width="12%">Y</td>
    <td width="65%">Foreign key to Subject table.</td>
  </tr>
  <tr valign="top"> 
    <td width="13%">name</td>
    <td width="10%">varchar</td>
    <td width="12%">Y</td>
    <td width="65%">Attribute name.</td>
  </tr>
  <tr valign="top"> 
    <td width="13%">value</td>
    <td width="10%">varchar</td>
    <td width="12%">Y</td>
    <td width="65%">Attribute value.</td>
  </tr>
  <tr valign="top"> 
    <td width="13%">searchValue</td>
    <td width="10%">varchar</td>
    <td width="12%">N</td>
    <td width="65%">Normalized search value. The values in this field need to 
      be lowercase values. Names may be stored in last-first or first-last format.</td>
  </tr>
</table>
<p>&nbsp;</p>
<p><b><a name="searching"></a>Searching for Subjects</b></p>
<p>The search() method may be used to find subjects. This method compares the 
  parameter value to the data in the SubjectAttribute.searchValue column using 
  the following matching strategy:</p>
<ul>
  <li>exact match of the parameter value OR</li>
  <li>for non-person subject type, case-insensitive substring match of the <a href="#normalized">normalized</a> 
    parameter value OR</li>
  <li>for &quot;person&quot; subject type, case-insensitive word match of the 
    <a href="#normalized">normalized</a> parameter value</li>
</ul>
<p>* <a name="normalized"></a>normalized: all non-alpha-numerics are converted 
  to a space except for apostrophes, which are removed</p>
<p><b>Retrieving Subjects</b></p>
<p>The JDBCSourceAdapter contains two methods to retrieve subjects: getSubject() 
  and getSubjectByIdentifier().</p>
<ul>
  <li>getSubject() - this method compares the parameter ID with the data in the 
    Subject.subjectID column to find a match.</li>
  <li>getSubjectByIdentifier() - this method compares the parameter ID with the 
    "loginid" attribute stored in the SubjectAttribute table.</li>
</ul>
<p><b><a name="config"></a>Configuring the JDBCSourceAdapter</b></p>
<p>Configuration of the JDBCSourceAdapter is specified in the sources.xml configuration 
  file. To configure the JDBCSourceAdapter, you'll need to specify the following 
  XML element/attributes:</p>
<table width="75%" border="1" cellpadding="4" cellspacing="0">
  <tr bgcolor="#CCCCCC" valign="top"> 
    <td width="25%"><i><strong>Element</strong></i></td>
    <td width="8%"><i><b>Required</b></i></td>
    <td width="67%"><i><strong>Desription</strong></i></td>
  </tr>
  <tr valign="top"> 
    <td width="25%">&lt;source adapterClass&gt;</td>
    <td width="8%">Y</td>
    <td width="67%">set to&quot;edu.internet2.middleware.subject.provider.JDBCSourceAdapter&quot;</td>
  </tr>
  <tr valign="top"> 
    <td width="25%">&lt;id&gt;</td>
    <td width="8%">Y</td>
    <td width="67%">user specified source ID</td>
  </tr>
  <tr valign="top"> 
    <td width="25%">&lt;name&gt;</td>
    <td width="8%">Y</td>
    <td width="67%">user specified source name</td>
  </tr>
  <tr valign="top"> 
    <td width="25%">&lt;type&gt;</td>
    <td width="8%">Y</td>
    <td width="67%">subject types that are contained in the Subject table</td>
  </tr>
</table>
<p>&nbsp;</p>
<table width="75%" border="1" cellpadding="4" cellspacing="0">
  <tr bgcolor="#CCCCCC" valign="top"> 
    <td width="26%"><i><strong>Element</strong></i></td>
    <td width="6%"><i><b>Required</b></i></td>
    <td width="68%"><i><strong>Desription</strong></i></td>
  </tr>
  <tr valign="top"> 
    <td width="26%"> 
      <p>&lt;init-param&gt;<br>
        &lt;param-name&gt;dbDriver</p>
    </td>
    <td width="6%">Y</td>
    <td width="68%">fully qualified database driver class name</td>
  </tr>
  <tr valign="top"> 
    <td width="26%"> 
      <p>&lt;init-param&gt;<br>
        &lt;param-name&gt;dbUrl</p>
    </td>
    <td width="6%">Y</td>
    <td width="68%">URL of the database</td>
  </tr>
  <tr valign="top"> 
    <td width="26%"> 
      <p>&lt;init-param&gt;<br>
        &lt;param-name&gt;dbUser</p>
    </td>
    <td width="6%">Y</td>
    <td width="68%">database user name</td>
  </tr>
  <tr valign="top"> 
    <td width="26%"> 
      <p>&lt;init-param&gt;<br>
        &lt;param-name&gt;maxActive</p>
    </td>
    <td width="6%">Y</td>
    <td width="68%">max number of database connections</td>
  </tr>
  <tr valign="top"> 
    <td width="26%"> 
      <p>&lt;init-param&gt;<br>
        &lt;param-name&gt;maxIdle</p>
    </td>
    <td width="6%">Y</td>
    <td width="68%">number of idle database connections</td>
  </tr>
  <tr valign="top"> 
    <td width="26%"> 
      <p>&lt;init-param&gt;<br>
        &lt;param-name&gt;maxWait</p>
    </td>
    <td width="6%">Y</td>
    <td width="68%">number of seconds to wait for a connection to open</td>
  </tr>
  <tr valign="top"> 
    <td width="26%"> 
      <p>&lt;init-param&gt;<br>
        &lt;param-name&gt;readOnly</p>
    </td>
    <td width="6%">N</td>
    <td width="68%">boolean indicating whether the connection is read only or 
      not (default is &quot;true&quot;). Note that Oracle databases may require 
      this parameter be set to &quot;false&quot;.</td>
  </tr>
</table>
<p>&nbsp;</p>
<p><i>Sample JDBCSourceAdapter configuration:</i></p>
<pre>
&lt;sources&gt;
  &lt;source adapterClass=&quot;edu.internet2.middleware.subject.provider.JDBCSourceAdapter&quot;&gt;
    &lt;id&gt;sample&lt;/id&gt;
    &lt;name&gt;My Source&lt;/name&gt;
    &lt;type&gt;person&lt;/type&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;dbDriver&lt;/param-name&gt;
      &lt;param-value&gt;org.hsqldb.jdbcDriver&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;dbUrl&lt;/param-name&gt;
      &lt;param-value&gt;jdbc:hsqldb:data/mydb&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;dbUser&lt;/param-name&gt;
      &lt;param-value&gt;user&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;dbPwd&lt;/param-name&gt;
      &lt;param-value&gt;password&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;maxActive&lt;/param-name&gt;
      &lt;param-value&gt;4&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;maxIdle&lt;/param-name&gt;
      &lt;param-value&gt;2&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;maxWait&lt;/param-name&gt;
      &lt;param-value&gt;5&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;source&gt;
&lt;sources&gt;
</pre>
<p>&nbsp;</p>
</body>
</html>
